# AIDA Reannotated
##Genereting Linking Candidates
The linking candidates for aida dataset are generated using adapted Kolitsas script. The adaptation to
this script consists in generating actual candidate links (ex: "New_York_City") instead of the 
internal ids used in Kolitsas paper (ex: 1234). This makes the output also more clear. 
This output is generated in the directory 'json_records' 
(`dwie_linker/third_party/kolitsas_e2e/data/json_records/corefmerge/allspans`). 
Check the `third_party.kolitsas_e2e.prepro_util.create_jsonrecords` newly added method. 

To run the adapted version the following script has to be executed: 

`python -m src.third_party.kolitsas_e2e.prepro_util --base_dir '/work/kzaporoj/projects/dwie_linker/dwie_linker/third_party/kolitsas_e2e/'`

This script was executed in the node n087-03.wall2.ilabt.iminds.be (alias "nodedwie4").
I think it has to be executed on external node because it is quite heavy, for example 
it has to load word embeddings (TODO: double check this). In order to debug on the 
node, `pdb.set_trace()` can be set in the code. Also it is likely to need to set the `PYTHONPATH`
variable to the directory where the codebase is located as: 

`export PYTHONPATH="${PYTHONPATH}:/work/kzaporoj/projects/dwie_linker/dwie_linker/src/"`

(14/04/2021 debugging notes) - The following are the most relevant files read/generated by this script that may be 
needed to, for example, pass back from a particular candidate link (ex: "New_York_City") 
to the respective id in order to
load entity embeddings (see also section "Using Kolitsas entity embeddings"):
  1. `third_party/kolitsas_e2e/data/json_records/corefmerge/allspans`: that's where the
  output is located. 
  2. `third_party/kolitsas_e2e/data/basic_data/wiki_name_id_map.txt`: wiki page names (titles) 
  to ids (wiki_ids). To get the wiki links I just replace spaces with underscores ('_'). 
  These ids are used in a number of downstream files. For example, they are used in 
  entity embeddings related files to map the embedding id to its respective wiki id 
  (e.g., `third_party/kolitsas_e2e/data/entities/wikiid2nnid/nnid2wikiid.txt`, 
  `third_party/kolitsas_e2e/data/entities/extension_entities/wikiid2nnid/nnid2wikiid.txt`).